<!DOCTYPE html>
<html>
<head>
<title>12.801: Problem Set 3</title>

<style>
h1 {text-align: center;}
.center_div {
  max-width: 60em;
  margin: auto;
}
.center_text{
  text-align: center;
}
figure {text-align: center;}
figcaption {text-align: justify;}
.definition {
display: block;
font-style: italic;
padding-top: 1em;
padding-bottom: 1em;
}
.definition:before {
content: "Definition. ";
font-weight: bold;
font-style: normal;
}
.definition[text]:before {
content: "Definition (" attr(text) "). ";
}
.proof {
display: block;
font-style: normal;
padding-top: 1em;
padding-bottom: 1em;
}
.proof:before {
content: "Proof. ";
font-style: italic;
}
.claim {
display: block;
font-style: italic;
padding-top: 1em;
padding-bottom: 1em;
}
.claim:before {
content: "Claim. ";
font-weight: bold;
font-style: normal;
}
.claim[text]:before {
content: "Claim (" attr(text) "). ";
}
</style>

<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

</head>
<body>
<div class="center_div">

<h1>12.801: Problem Set 3</h1>

<hr style="width: 60em;">

<! <div style="text-align: center;"> 
<!All plots are appended in full-size to the end of this document for closer viewing, if wanted and/or needed.
</div>

<h3>The Setup</h3>

We consider the Stommel wind-driven gyre model, which has the linear vorticity balance:
\begin{equation}
	\beta \partial_x\psi = \frac{f}{D}\left( w_{Ek} - w_B \right) - \epsilon \Delta \psi,
\end{equation}
where we define the Laplacian as $\Delta = \nabla^{2}$. 
We can derive this equation by considering a single layer of homogeneous fluid with thickness $D$ that is below a mixed layer of thickness $h_M$ which transports the wind stress into the homogeneous layer.
At the bottom of the single layer, there is a viscous boundary layer of thickness $\delta_E$ wherein the viscous stresses produced by the fluid motion against the bottom act on the fluid layer.
We assume that in this layer, the north-south motion is small enough that the $\beta$-plane approximation is valid and that the velocity of the fluid is small enough that the fluid is in geostrophic balance such that:
\begin{equation}
	\beta L / f_0 \ll 1,
\end{equation}
which allows us to write the fluid motion as:
\begin{equation}
	u = - \partial_y\psi \quad \text{ and } \quad v = \partial_x\psi,
\end{equation}
where we define $\psi = p / \rho f_0$.
We also define the total vorticity as a summation of the relative vorticity and the planetary vorticity, i.e.:
\begin{equation}
	Q = \zeta + f = \partial_xv - \partial_yu + f_0 + \beta y.
\end{equation}
Now, as the horizontal velocities are independent of depth, we have that the only way our vorticity equation $Q$ for this model can be modified is if there is a change in the vortex stretching (i.e., a vertical change in $w$) or in lateral diffusion. 
We can write this as:
\begin{equation}
	\frac{\textrm{d}Q}{\textrm{d}t} = \left(\zeta + f_0 + \beta y \right)\partial_z w + A_H \Delta \zeta,
\end{equation}
where we have introduced the horizontal diffusivity $A_H$. 
By our definition of the model above as geostrophic, we know that $\beta y  \ll f_0$ and $\zeta \ll f_0$, for the second term being that the relative vorticity $\zeta$ is small given that the velocities and their rates of change small.
Therefore, we can write the above equation as:
\begin{equation}
	\frac{\textrm{d}\zeta}{\textrm{d}t} + \beta v = f_0 \partial_z w  + A_H \Delta \zeta.
\end{equation}
Assuming hydrostatic balance, $\partial_z p = - \rho g$, we can integrate the above equation with respect to $z$ as follows:
\begin{equation}
\left( \frac{\textrm{d}Q}{\textrm{d}t} + \beta v - A_H \Delta \zeta \right) \int_{-D}^0 \text{d}z = f_0\int_{w_B^\ast}^{w_{Ek}} \text{d}w,
\end{equation}
giving, assuming steady state (i.e., time-independent circulation):
\begin{equation}
	\beta v = \frac{f_0}{D}\left( w_{Ek} - w_B^\ast \right) + A_H \Delta \psi,
\end{equation}
where we have assumed that the limits of our vertical velocity are decomposed into:
\begin{align}
	\text{Top: }& w_{Ek,}  \\
	\text{Bottom: }& w_B^\ast = w_B + w_{Ek,B},
\end{align}
where $w_{Ek}$ is the Ekman vertical velocity at the surface produced by wind stress and transported through the mixed layer, $w_B = - \underline{u}\cdot \nabla D$ is the vertical velocity at the bottom of the single homogeneous layer induced by the bottom fluid flow $\underline{u}_B$, and $w_{Ek, B}$ is the bottom vertical Ekman velocity.
From Pedlosky (1987), we know that we can define:
\begin{equation}
	w_{Ek,B} = \frac{\delta_E}{2}\zeta.
\end{equation}
Therefore, substituting in our relation between the streamfunction and the meridional velocity, we get:
\begin{equation}
	\beta \partial_x\psi = \frac{f_0}{D}\left( w_{Ek} - w_B \right) - \epsilon\Delta\psi + A_H \nabla ^4 \psi,
\end{equation}
where we introduced the factor:
\begin{equation}
	\epsilon = \frac{f_0\delta_E}{2D}.
\end{equation}
The Stommel model does not consider the lateral transfer of momentum to a coast through turbulent stresses (unlike the Munk model), rather the stress from the bottom Ekman layer, i.e. we neglect the fourth-order $\nabla ^4\psi$ term but keep the second-order $\Delta\psi$ term in the equation above.
Thus, we arrive at the model we are interested in this problem set, namely:
\begin{equation}
	\beta \partial_x\psi = \frac{f_0}{D}\left( w_{Ek} - w_B \right) - \epsilon \Delta \psi.
\end{equation}

<h3>Mathematical Preliminaries</h3>

We recall the following:
<div class="definition" text="Solution to a Second-Order, Homogenous Ordinary Differential Equation">
The solution to a second-order, homogeneous ordinary differential equation $X_{h}(x)$ is given by:
\begin{equation}
	X_h = a\exp\left[\lambda_1 x\right] + b\exp\left[\lambda_2x\right],
\end{equation}
for $\lambda_i$ the two roots of the characteristic polynomial for $X_{h}(x)$ and $a,b$ undetermined constants.
</div>
We then recall the subsequent solution for a non-homogeneous equation:
<div class="definition" text="Solution to a Second-Order, Non-homogeneous Ordinary Differential Equation">
The solution to a second-order, non-homogeneous ordinary differential equation equation $X_{nh}(x)$ is given by:
\begin{equation}
	X = X_h(x) + X_p(x),
\end{equation}
where the particular solution $X_p(x)$ is to be determined. 
</div>
Handily, we recall the following:
<div class="claim" text="Method of Undetermined Coefficients">
A common way of solving for particular, second-order solutions is to assume a function of the form:
\begin{equation}
	X_p = cY(x),
\end{equation}
where $Y(x)$ is the functional form of the non-homogeneous part, such as $\exp, \sin$, etc., and $c$ is a constant to be determined (there could be multiple per term of $Y(x)$).
By plugging in $X_p(x)$ into the non-homogeneous equation and solving for $c$ (or the multiple coefficients), we come to a solution of our equation of interest. 
</div>
Lastly, we remember the following geometric definition:
<div class="definition" text="Arc Length">
The arc length $S$ is defined as the path length traversed a central angle $\theta$ along the circumference of a circle of radius $R$, calculated by:
\begin{equation}
	S = R\theta.
\end{equation}
</div>
In our case, we will let $R$ be the radius of the Earth and $\theta$ be longitude or latitude.

<h3>The Flat Bottom Double Gyre</h3>

<h4>Ekman Transport</h4>
Now, with those preliminaries out of the way, we proceed to solve the Stommel model for $w_B=0$, that is for a flat bottom.
To begin, we calculate the Ekman velocity, recalling from lecture that:
\begin{equation}
	w_{Ek} = \frac{1}{f_0\rho_0}\nabla \times \underline{\tau}_w,
\end{equation}
where we are given that:
\begin{equation}
	\underline{\tau}_w = \begin{bmatrix} \tau_0\cos\left[\pi\left( y - 45^\circ \right)/ 25^\circ\right] \\ 0 \end{bmatrix}, 
\end{equation}
i.e., we have a purely zonal wind stress.
Therefore, we calculate that:
\begin{equation}
	w_{Ek} = \frac{\tau_0\pi}{f_0\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right].
\end{equation}

<h4>Interior Solution</h4>
Now, in this problem set we will assume that our streamfunction of interest is defined as:
\begin{equation}
	\psi = \psi_I + \psi_B,	
\end{equation}
where we have decomposed the streamfunction into the interior $I$ and boundary $B$ solutions. 
We want to determine the leading order terms in each region. 
To do this, we rearrange our vorticity equation to be of the form:
\begin{equation}
	L_s\Delta\psi + \partial_x\psi = \frac{f_0}{\beta D}w_{Ek},
\end{equation}
we have defined the width of the Stommel boundary layer as $L_s = \epsilon / \beta = L_x / 100$.
Now, we perform some scaling analysis, with $W_E$ the magnitude for Ekman transport, finding that:
\begin{align}
	\partial_x\psi &\sim \frac{UL}{L} \simeq \frac{W_E f_0}{\beta D} = \frac{10^{-7}10^{-4}}{10^{-11}10^3} = 10^{-3}, \\
	L_s\Delta\psi &\sim \frac{UL}{L^2}\frac{L}{10^2} \simeq \frac{W_E f_0}{\beta D 10^2} = \frac{10^{-7}10^{-4}}{10^{-11}10^310^2} = 10^{-5}.
\end{align}
Therefore, in the interior we note that $\mathcal{O(\partial_x\psi}) \gg \mathcal{O}(L_s\Delta\psi)$, meaning that we can neglect the stress from the bottom Ekman layer in the interior (i.e., we are in Sverdup balance).
This means then that we have the first-order differential equation:
\begin{equation}
	\partial_x\psi_I = \frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right].
\end{equation}
We can solve this using Separation of Variables, to get:
\begin{equation}
	\psi_I = \frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]x + C,
\end{equation}
where we determine the constant $C$ with the boundary condition (BC): $\psi_I(L_x, y) = 0$, for $L_x$ the length of the $x$ domain, which means then that:
\begin{equation}
	C = -\frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]L_x.
\end{equation}
Thus, our interior streamfunction is given by:
\begin{equation}
	\psi_I = \frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]\left( x - L_x \right).
\end{equation}

<h4>Boundary Solution</h4>

Next, we have to find the boundary solution, $\psi_B$.
To do this, we note that, in the western boundary current, the streamfunction will be varying greatly in $x$ to accommodate the needed northward mass transport, giving:
\begin{equation}
\partial_x\psi_B \gg \partial_y\psi_B.
\end{equation}
Therefore, we can simplify our second-order Ekman stress term into $\Delta \to \partial_{x x}$.
Next, we perform scaling analysis in the western boundary current of width $L_s$, noting first that $\psi_B$ has to be at least as great as $\psi_I$ as one interfaces with the other as $x \to L_x$.
Therefore, we get:
\begin{align}
	\beta \partial_x\psi_B &\gtrsim \frac{\beta\psi_I}{L_s} = \frac{\beta U L}{L_s} = \frac{W_Ef_0L}{L_sD} = \frac{10^{-7}10^{-4}10^{6}}{10^{4}10^3} = 10^{-12}, \\
	\epsilon \partial_{x x}\psi_B &\gtrsim \frac{\beta L_s\psi_I}{L_s^2} = \frac{\beta U L}{L_s} = \frac{W_Ef_0L}{L_sD} = \frac{10^{-7}10^{-4}10^{6}}{10^{4}10^3} = 10^{-12}, \\
	\frac{\beta f_0}{D}w_{Ek} &\sim \frac{W_E f_0}{D} = \frac{10^{-7}10^{-4}}{10^3} = 10^{-14}.
\end{align}
This then means that we can neglect the Ekman transport in the boundary layer, leading to the second-order, homogeneous linear differential equation:
\begin{equation}
	\partial_{x x}\psi_B + \frac{1}{L_s}\partial_x\psi_B = 0.
\end{equation}
To solve this equation, we first hold all $y$ constant, meaning that we can treat this as an ordinary differential equation. 
Therefore, we recall our definition of the solution to equations of this type and assume an ansatz to this equation of the form $\psi = \text{e}^{\lambda x}$.
Plugging this into our differential equation, we get the characteristic polynomial:
\begin{equation}
	\lambda^{2} + \frac{1}{L_s}\lambda = 0,
\end{equation}
which has roots $\lambda = 0, - 1 / L_s$. Therefore, we get a solution of the form:
\begin{equation}
	\psi_B = a + b\exp\left[- \frac{x}{L_s}\right].
\end{equation}
To solve for $a$, we note the BC $\psi(L_x, y) = 0$, giving:
\begin{equation}
a = -b\exp\left[\frac{L_x}{L_s}\right] \to 0,
\end{equation}
given that $L_s \ll L_x$ and that $\psi_I(L_x, 0) = 0$.
Then, we use the BC $\psi(0, y) = 0$, which gives:
\begin{equation}
	b = \frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]L_x.
\end{equation}
Therefore, our boundary solution is:
\begin{equation}
	\psi_B = \frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]L_x\exp\left[- \frac{x}{L_s}\right].
\end{equation}

<h4>Full Solution</h4>

This all means that our full solution for the flat bottom, double gyre Stommel model is given by:
\begin{equation}
	\Psi_F = D\psi_F = \psi_{F,I} + \psi_{F,B} = \frac{\tau_0\pi L_x}{\beta\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]\left(\frac{x}{L_x} + \exp\left[- \frac{x}{L_s}\right] - 1\right).
\end{equation}
We plot this solution in Fig. 1 below, where we have defined the nondimensional domain variables:
\begin{equation}
	\widehat{x} = \frac{x}{L_x} \quad \text{ and } \quad \widehat{y} = \frac{y - 20^\circ}{50^\circ}. 
\end{equation}
Additionally, we have used the following values:
\begin{align}
	\tau_x &\sim 8 \times 10^{-2} \: \left[\text{kg} \text{ m}^{-1} \text{s}^{-2}\right], \\	
	L_x &\sim 60 \: \left[\text{degrees West}\right], \\
	L_s &\sim L_x / 10^2 \: \left[\text{degrees West}\right], \\
	\beta &\sim 2 \times 10^{-11} \: \left[\text{s}^{-1} \text{m}^{-1}\right], \\
	\rho_0 &\sim 1 \times 10^{3} \: \left[\text{kg} \text{ m}^{-3}\right], \\
	f_0 &\sim 1 \times 10^{-4} \: \left[\text{s}^{-1}\right], \\
	R &\sim 6371000 \: \left[\text{m}\right].
\end{align}
Importantly, we remember our definition of arc length, which allows us to convert the units of $L_s \to L_s R L_x$.
<figure>
	<img src="images/prob1a_revised.png" style="width:60%">
	<figcaption> Fig. 1: The streamfunction solution $\Psi_F = D \psi_F$ to the flat bottom double gyre problem, with the solution plotted in Sverdrups and the domain nondimensionalized.</figcaption>
</figure>

We can see that the expected symmetric, two gyre solution is exhibited in Fig. 1, with a difference in the cyclonicity of the gyres also as expected.
Additionally, as was a fundamental result of Stommel's original work, we note that presence of a western boundary current in both gyres that was revolutionary in our understanding of ocean circulation in his 1947 paper.

<h4>Proportional Meridional Velocity</h4>

Now, we can examine a zonal cross section of the proportional meridional velocity structure across our solution by defining:
\begin{equation}
	X = \frac{x}{L_x} + \exp\left[- \frac{x}{L_s}\right] - 1.
\end{equation}
Then, we can estimate a proportional meridional velocity distribution using:
\begin{equation}
	\frac{\textrm{d}X}{\textrm{d}x} = \frac{1}{L_x} - \frac{1}{L_s}\exp\left[- \frac{x}{L_s}\right].
\end{equation}
We plot this profile in Fig. 2 in the solid red line.
An important comparison is with the Munk model, which as discussed earlier considers the fourth-order lateral diffusion of vorticity in the $\nabla ^4 \psi$ term.
The proportional meridional velocity is given, from our notes, as:
\begin{equation}
\frac{2}{\sqrt{3}}\exp\left[-\frac{x}{L_M}\right]\sin\left[\frac{\sqrt{3}}{2}\frac{x}{L_M}\right],
\end{equation}
for $L_M$ the width of the Munk layer.
For a basic comparison, we plot a proportional distribution of the Munk meridional velocity in the dashed black line in Fig. 2, where we have both negated and assumed $L_M \simeq L_S$ for the basic sake of comparison, though this is not necessarily true in the exact sense.
Additionally, here we have defined $\widehat{x} = x / L_s$ and plotted it out to 20.
<figure>
	<img src="images/prob1b_revised.png" style="width:60%">
	<figcaption> 
		Fig. 2: Zonal cross section of a proportional meridional velocity.
		The solid red line is the section for our flat bottom gyre Stommel solution, compared to the dashed black line which is Munk's solution. 
		The dotted black line is the $\text{d}X / \text{d}x =0$ line, at which point the direction of the velocities change from northward (positive) to southward (negative).
		Note the nondimensionalized zonal coordinate.
	</figcaption>
</figure>
There are a number of key similarities and differences between these two solutions plotted in Fig. 2.
First, we note that there is a presence of the western boundary current in both solutions, despite the maximum of the peaks occurring in different zonal positions, at the boundary for the Stommel solution and slightly within the Munk boundary layer for the Munk solution.
The Munk solution also exhibits a counter-current that balances out the flow in the western boundary current. This is not present in the Stommel solution.
The solutions at the boundaries are also different. 
Our current in the region near $x=0$ is greatly negative, but asymptotically approaches a slightly positive (i.e., northward) value that balances out the negative western boundary current (southward).
We contrast this to the Munk solution, which exhibits a no-slip boundary condition that supports the lateral diffusion term of vorticity $\nabla ^4 \psi$, this is to say that $\partial_x \psi = 0$, which is something that we do not assume in our derivation of the streamfunction solution.
Therefore, we correspondingly see that the Munk solution is $\text{d}X / \text{d}x (0, y) = \text{d}X / \text{d}x (L_x,y) = 0$ which we do not see in the Stommel solution.

<h3>The Non-flat Bottom Double Gyre</h3>

<h4>Interior Solution</h4>
We now have that $w_{BB} \not=0$, for $w_B = w_{BB}\exp\left[- \gamma x / L_s\right]$. Therefore, our vorticity equation is of the form:
\begin{equation}
	\beta\partial_x\psi + \epsilon\Delta\psi = \frac{f_0}{D}\left( w_{Ek} - w_B\right).
\end{equation}
We are given that:
\begin{equation}
w_B = \begin{cases} w_0\sin\left[\pi\left( y - 50^\circ \right) / 20^\circ\right]\exp\left[-\gamma x / L_s\right] & y \in \left[30^\circ, 50^\circ\right], \\ 0 & \text{otherwise,} \end{cases}
\end{equation}
for $\gamma, w_0$ constants.
Here we note the $\text{e}-$folding length of $w_B$ is $L_s / \gamma \sim 10^{4} / 10^{-1} = 10^5$ [m], which is an order of magnitude less than the length of the $x$ domain.
Therefore, we would get a drop-off of $e^{-5}$ by the zonal mid-point of the gyre. 
Thus, we get:
\begin{align}
\partial_x \psi_I &\gg L_S \Delta \psi_I, \\
w_{Ek} &\gg w_{B}.
\end{align}
This all then means that in the interior of the gyre, our vorticity equation is:
\begin{equation}
	\partial_x\psi_I = \frac{f_0}{\beta D}w_{Ek},
\end{equation}
which we note is the same interior equation for the flat bottom case. 
Thus, we get that the interior solution is, as before:
\begin{equation}
	\psi_I = \frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]\left( x - L_x \right).
\end{equation}

<h4>Boundary Solution</h4>

Now, to find the boundary solution for $w_{BB}\not=0$, that is we are in the domain of $y \in \left[30^\circ, 50^\circ\right]$, we note that in the boundary layer, in addition to the scaling analysis performed in the Flat Bottom case, we have that:
\begin{align}
	w_B \sim \frac{w_0 f_0\mathcal{O}(10^{-1 \text{ to } 0})}{D} \simeq 10^{-11 \text{ to } -12},
\end{align}
where we have noted that the $\sin\left[\cdot\right]\exp\left[\cdot\right]$ contributes $(10^{-1 \text{ to } 0})$.
We can see that this is the same order as as $\partial_x\psi_B$ and $\partial_{x x}\psi_B$, where we have again noted that $\partial_x \psi_B \gg \partial_y \psi_B$.
Therefore, we get the second-order nonhomogenous differential equation:
\begin{equation}
	\partial_{x x}\psi_B + \frac{1}{L_s}\partial_x\psi_B = - \frac{f_0w_0}{\epsilon D} \sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\exp\left[-\gamma \frac{x}{L_s}\right]\delta_{II},
\end{equation}
where we have defined the region Kronecker $\delta$
\begin{equation}
\delta_{II} = \begin{cases} 1 & y \in \left[30^\circ, 50^\circ\right], \\ 0 & \text{ otherwise}. \end{cases}
\end{equation}
Now, we start the solving by recalling our definition of solutions for equations of this form, by first assuming that we can turn this equation into an ordinary differential equation by holding all $y$ constant.
We apply the same ansatz to the homogeneous part of this equation to get a characteristic polynomial with roots $\lambda = 0, -1 / L_s$, leading to a homogeneous general solution of the form:
\begin{equation}
	\psi_{B,h} = b\exp\left[-\frac{x}{L_s}\right].
\end{equation}
where we have again found, given the BC $\psi(L_x, y) = 0$, that $a = 0$.
Next, we want to find the particular solution by proposing an ansatz, following our claim of the Method of Undetermined Coefficients, as:
\begin{align}
	\psi_{B,p} &= a\exp\left[-\gamma \frac{x}{L_s}\right], \\
	\partial_x\psi_{B,p} &= -a \frac{\gamma}{L_s} \exp\left[-\gamma \frac{x}{L_s}\right], \\
	\partial_{x x}\psi_{B,p} &= a \frac{\gamma^{2}}{L_s^2} \exp\left[-\gamma \frac{x}{L_s}\right].
\end{align}
Plugging these into our non-homogeneous equation, we can simplify to get:
\begin{equation}
\frac{\gamma^{2}a}{L_s^{2}} - \frac{\gamma a}{L_s^{2}} = - \frac{f_0w_0}{\epsilon D} \sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\delta_{II}.
\end{equation}
This then gives:
\begin{equation}
	a = - \frac{f_0w_0L_s^{2}}{\left( \gamma^{2} - \gamma \right) \epsilon D} \sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\delta_{II}.
\end{equation}
Then, applying the boundary condition:
\begin{equation}
	0 = \psi(0, y) = \psi_I + \psi_{B,h} + \psi_{B,p} = -\frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]L_x + b - \frac{f_0w_0 L_s^{2}}{\left( \gamma^{2} - \gamma \right) \epsilon D} \sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\delta_{II},
\end{equation}
we can get that:
\begin{equation}
	b = \frac{\tau_0\pi}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]L_x + \frac{f_0w_0 L_s^{2}}{\left( \gamma^{2} - \gamma \right) \epsilon D} \sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\delta_{II}.
\end{equation}
Therefore, we have that our boundary solution is:
\begin{equation}
	\psi_B = \frac{\tau_0\pi L_x}{\beta D\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right]\exp\left[- \frac{x}{L_s}\right] + \frac{f_0w_0 L_s^{2}}{\left( \gamma^{2} - \gamma \right) \epsilon D} \sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\delta_{II}\left( \exp\left[- \frac{x}{L_s}\right] - \exp\left[-\gamma \frac{x}{L_s}\right] \right).
\end{equation}

<h4>The Full Solution</h4>

Putting all of this together, we get that our full solution is:
\begin{equation}
\begin{split}
	\Psi_S = D \psi_S = &\frac{\tau_0\pi L_x}{\beta\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ} \right]\left( \frac{x}{L_x} + \exp\left[- \frac{x}{L_s}\right] - 1\right) + \\ &\frac{f_0w_0 L_s^{2}}{\left( \gamma^{2} - \gamma \right) \epsilon } \sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\delta_{II}\left( \exp\left[- \frac{x}{L_s}\right] - \exp\left[-\gamma \frac{x}{L_s}\right] \right).
\end{split}
\end{equation}
We plot this solution in the bottom panel Fig. 3, with the corresponding $w_B$ for this problem with $\gamma = 0.4$ in the top panel for comparison.

<figure>
	<img src="images/prob2_revised.png" style="width:60%">
	<figcaption> Fig. 3: Bottom stress forcing, $w_B$ (top) and streamfunction solution $\Psi_S = D \psi_S$ to the non-flat bottom double gyre problem.
	We again note that $\Psi_F$ is plotted in Sverdups and the domain is nondimensionalized.
	The deformation of the symmetric streamfunction between $30^\circ$ and $50^\circ$ is is an important feature of the streamfunction solution.
	Here, $\gamma = 0.4$, as is given in the question.
	</figcaption>
</figure>

We can see that the non-flat bottom disrupts the symmetric double gyre solution for the flat bottom over the western boundary current region in which $w_B$ is dominant (which is proportional to the $\text{e}$-folding scaling analysis discussed previously), predominantly (with the current value of $\gamma$) at the western boundary for $y \in \left[30^\circ, 50^\circ\right]$.
Additionally, we can see that $w_B$ provides a negative perturbation to our solution, which we see in the streamfunction by a continuation of the subpolar gyre transport into the subtropical gyre circulation, this is to say there are negative transport contours perturbing the positive contours of the subtropical gyre.
The magnitudes of the transport nearly stay the same, with a slight increase in the negative transport within the subpolar perturbed gyre transport.
Very simply, we see that when there is downwelling (upwelling) in the western boundary current, the subpolar (subtropical) gyre encroaches on the subtropical (subpolar) gyre.
Our current solution field for $w_B$ is consistent with a flow outward from the western boundary current down the shelf into an abyss. 
We also consider the case in which there is a positive perturbation to our solution in Fig. 4, i.e., $w_B > 0$.

<figure>
	<img src="images/prob2b_revised.png" style="width:60%">
	<figcaption> Fig. 4: The case in which we change the sign of the bottom stress term, that is we have a positive vertical velocity that exponentially decreases to 0 away from the side.</figcaption>
</figure>

This is the case in which we have translated the $\sin$ within the $w_{BB}$ term by a half-period such that the amplitude is negative.
We can see that we have the negated effect as seen in Fig. 3, that is that there is an amplification of transport over the region in which $w_B$ is dominant in the subtropical gyre which makes the positive transport more than a factor of two greater. 
Correspondingly, we get that positive transport protrudes into the subpolar, negative transport circulation gyre in this solution.
There is little change in the negative transport magnitude compared to the flat bottom solution.

<h3>Parameter Sensitivity</h3>

<figure>
	<img src="images/prob3_psi_gamma_revised.png" style="width:60%">
	<figcaption> 
		Fig. 5: A parameter sensitivity study of the bottom pressure torque forcing $w_B$ (left column) and the resulting streamfunction $\Psi_S$ (right column) for a range of $\gamma \in \left[0.01, 0.1, 0.25, 0.5, 0.75, 1.0, 10\right]$.
		We note the decreasing perturbation in $\Psi_S$ caused by $w_B$ as $\gamma$ increases.
		The domain is again nondimensionalized and the streamfunction plotted in Sverdrups.
	</figcaption>
</figure>

We now run a parameter sensitivity on our model through a range of $\gamma$ values that span a range of magnitudes, from $10^{-2}$ to $10^1$.
Specifically, we plot 7 solution fields for $w_B$ (left column) and $\Psi_S$ (right column) for $\gamma \in \left[0.01, 0.1, 0.25, 0.5, 0.75, 1.0, 10\right]$ (with the values of $\gamma$ increasing with rows).
The biggest effect seen with increasing $\gamma$ is the reduction in the area of dominant $w_B$, which is based on our $\text{e}$-folding scale analysis and can be seen by scanning down the left column of Fig. 5 above.
As $\gamma$ increases, we have a decreased $\text{e}$-folding scale, meaning that the exponential decay is greater with increasing $\gamma$. 
For small $\gamma$, we get that $w_B$ is dominant far into the gyre, an effect which decreases exponentially with increasing $\gamma$.
We can think of this as the roll of topography in the circulation increasing with decreasing $\gamma$. 
This then means that, for reasonable values of $\gamma$ (namely, $\gamma \ge  0.25$), we see that perturbations imposed by the $w_B$ term decreases, and therefore the subtropical gyre has less perturbation with increasing $\gamma$, until we get that for $\gamma \sim 10^0 - 10^1$, we are back to the symmetric solution of the double, flat bottom as before.
Another way of thinking of this is that in this regime, we are working with an $\text{e}$-folding scale that is the order of $L_s$, meaning that in this regime $w_{Ek}$ takes over as the dominant term in the circulation.
This is understandable as with a very short $\text{e}$-folding length scale, we basically have $w_{Ek}$ as the dominant forcing, causing the flat bottom gyre circulation pattern seen for large $\gamma$.
Additionally, our analysis shows that there are some bounds on reasonable values of $\gamma$, as those less than 0.25 seem to give aphysical circulation patterns (the transport values are massive). 

<h3>Removing Topographic Effects</h3>

Lastly, we are interested in finding a distribution of $w_B$ that balances out the spatial distribution imposed on $\psi$ by $w_{Ek}$
Therefore, we want to find a distribution such that $w_B = w_{Ek}$. 
To do this, we calculated the contribution to the geostrophic streamfunction of each as we know that:
\begin{equation}
	\Psi_{geo} = -\int_{L_x}^x \text{d}x' \: w(x', y).
\end{equation}
Therefore, we have that:
\begin{equation}
	\frac{\tau_0 \pi}{f_0\rho_0 25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ}\right] \int_0^{L_x}\text{d}x = w_{BB}\sin\left[\frac{\pi\left( y - 50^\circ \right) }{20^\circ}\right]\int_{0}^{L_x}\text{d}x' \: \exp\left[-\gamma \frac{x}{L_s}\right],
\end{equation}
which gives a $w_{BB}$ of:
\begin{equation}
	w_{BB} = \frac{\gamma \tau_0 \pi L_x}{f_0\rho_{0}25^\circ Ls} \frac{\sin\left[\pi\left( y - 45^\circ \right) / 25^\circ\right]}{1- \exp\left[- \gamma L_x / L_s\right]}.
\end{equation}
So, we get a distribution of the form:
\begin{equation}
	w_B = \frac{\gamma \tau_0 \pi L_x}{f_0\rho_{0}25^\circ Ls} \frac{\sin\left[\pi\left( y - 45^\circ \right) / 25^\circ\right]}{1- \exp\left[- \gamma L_x / L_s\right]} \exp\left[-\gamma \frac{x}{L_s}\right].
\end{equation}
We can then correspondingly get an adjusted streamfunction given by:
\begin{equation}
\begin{split}
	\Psi_S = D \psi_S = &\frac{\tau_0\pi L_x}{\beta\rho_{0}25^\circ}\sin\left[\frac{\pi\left( y - 45^\circ \right) }{25^\circ} \right]\left( \frac{x}{L_x} + \exp\left[- \frac{x}{L_s}\right] - 1\right) + \\ &\frac{\gamma \tau_0 \pi L_x}{f_0\rho_{0}25^\circ Ls} \frac{\sin\left[\pi\left( y - 45^\circ \right) / 25^\circ\right]}{1- \exp\left[- \gamma L_x / L_s\right]} \exp\left[-\gamma \frac{x}{L_s}\right]\left( \exp\left[- \frac{x}{L_s}\right] - \exp\left[-\gamma \frac{x}{L_s}\right] \right).
\end{split}
\end{equation}
We plot these solution fields below in Fig. 6, where we note we have applied the arc length calculation to our value of $25^\circ$ to convert to S.I. units.
<figure>
	<img src="images/prob4_revised.png" style="width:60%">
	<figcaption> 
		Fig. 6: A possible distribution of $w_B$ (middle) that removes the effects imposed by $w_{Ek}$ (top) on the resulting streamfunction $\Psi_S$ (bottom).
		We note the streamfunction resembles the solution to the flat bottom streamfunction $\Psi_F$.
		The domain is nondimensionalized and the streamfunction plotted in Sverdrups.
	</figcaption>
</figure>

Here, we clearly see that we have found a distribution of $w_B$ the balances the imposed patterns of $w_{Ek}$, as the solution field for $\psi$ is that of the flat bottom, double gyre problem shown and derived above.
We see that the magnitude of our new $w_B$ term, which we call $w_{B, Ek}$, is greater than that of $w_{Ek}$, but this is balanced out by the greatly reduced area over which this magnitude is imposed in the western boundary current to that of the Ekman layer, which is across the entire zonal domain.
Furthermore, we see that the signs of both $w_{Ek}$ and $w_{B, Ek}$ are the same in the corresponding gyres (positive/upwelling in the subpolar and negative/downwelling in the subtropical).
In these ways, we have found a flow over the bottom topography that results in a form drag than balances the wind in an integral sense.

<hr style="width: 60em;">

</div>
</body>
</html>
